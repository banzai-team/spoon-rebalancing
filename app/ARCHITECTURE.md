# Архитектура проекта

Проект организован в модульную структуру для лучшей поддерживаемости и масштабируемости.

## Структура проекта

```
app/
├── __init__.py
├── db/                    # Модуль работы с базой данных
│   ├── __init__.py
│   ├── base.py           # Base для SQLAlchemy
│   ├── models.py         # Модели БД (User, Wallet, Strategy, etc.)
│   └── session.py        # Сессии и зависимости для FastAPI
│
├── api/                   # API слой
│   ├── __init__.py
│   ├── main.py           # FastAPI приложение
│   ├── schemas.py        # Pydantic схемы для валидации
│   └── routes/           # API роуты
│       ├── __init__.py
│       ├── wallets.py    # Роуты для кошельков
│       ├── strategies.py  # Роуты для стратегий
│       ├── recommendations.py  # Роуты для рекомендаций
│       ├── chat.py        # Роуты для чата
│       └── agent.py       # Роуты для управления агентом
│
└── services/              # Бизнес-логика
    ├── __init__.py
    ├── wallet_service.py
    ├── strategy_service.py
    ├── recommendation_service.py
    ├── chat_service.py
    └── agent_service.py
```

## Модули

### `app/db/` - Работа с базой данных

- **`base.py`** - Базовый класс для SQLAlchemy моделей
- **`models.py`** - Все модели базы данных (User, Wallet, Strategy, etc.)
- **`session.py`** - Настройка подключения к БД, сессии и зависимости

### `app/api/` - API слой

- **`main.py`** - Главный файл FastAPI приложения, настройка CORS, подключение роутов
- **`schemas.py`** - Pydantic схемы для валидации запросов и ответов
- **`routes/`** - Роуты API, разделенные по функциональности

### `app/services/` - Бизнес-логика

Сервисы содержат всю бизнес-логику приложения, отделенную от API слоя. Это позволяет:
- Легко тестировать логику отдельно от API
- Переиспользовать код в разных местах
- Изменять API без изменения бизнес-логики

## Принципы организации

1. **Разделение ответственности**: Каждый модуль отвечает за свою область
2. **Dependency Injection**: Зависимости передаются через параметры функций
3. **Сервисный слой**: Вся бизнес-логика в сервисах, роуты только вызывают сервисы
4. **Типизация**: Использование Pydantic для валидации и типизации

## Запуск

```bash
# Запуск API сервера
python run.py

# Или через uvicorn напрямую
uvicorn app.api.main:app --reload
```

## Миграции

```bash
# Применить миграции
python init_db.py

# Или через Alembic
uv run alembic upgrade head
```

