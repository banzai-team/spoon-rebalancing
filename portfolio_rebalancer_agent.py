"""
–ê–≥–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª—è
"""
import asyncio
import json
from typing import Dict, Any, Optional
from spoon_ai.agents.toolcall import ToolCallAgent
from spoon_ai.chat import ChatBot
from spoon_ai.tools.crypto_tools import get_crypto_tools
from spoon_ai.tools import ToolManager
from portfolio_rebalancer_tools import (
    GetTokenPricesTool,
    CalculateRebalancingTool,
    EstimateGasFeesTool,
    SuggestRebalancingTradesTool
)


class PortfolioRebalancerAgent(ToolCallAgent):
    """AI-–∞–≥–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª—è"""
    name: str = "portfolio_rebalancer_agent"
    description: str = "AI –∞–≥–µ–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞"

    system_prompt: str = """
    –¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞–≥–µ–Ω—Ç –¥–ª—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª—è.
    
    –¢–í–û–Ø –ì–õ–ê–í–ù–ê–Ø –ó–ê–î–ê–ß–ê: –ü–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤ –≤ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª–µ.
    
    –î–û–°–¢–£–ü–ù–´–ï –§–£–ù–ö–¶–ò–ò:
    1. get_portfolio_balance - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ—Ä—Ç—Ñ–µ–ª—è –∏–∑ –∫–æ—à–µ–ª—å–∫–æ–≤
    2. get_token_prices - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ –≤ USD
    3. calculate_rebalancing - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
    4. estimate_gas_fees - –û—Ü–µ–Ω–∏—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –≥–∞–∑ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    5. suggest_rebalancing_trades - –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–¥–µ–ª–∫–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
    
    –ü–†–û–¶–ï–°–° –†–ê–ë–û–¢–´:
    1. –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ—Ä—Ç—Ñ–µ–ª—è (get_portfolio_balance)
    2. –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ (get_token_prices)
    3. –†–∞—Å—Å—á–∏—Ç–∞–π —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    4. –°—Ä–∞–≤–Ω–∏ —Å —Ü–µ–ª–µ–≤—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–π –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (calculate_rebalancing)
    5. –û—Ü–µ–Ω–∏ –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –≥–∞–∑ (estimate_gas_fees)
    6. –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–¥–µ–ª–∫–∏, –µ—Å–ª–∏ –≤—ã–≥–æ–¥–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∏–∑–¥–µ—Ä–∂–∫–∏ (suggest_rebalancing_trades)
    
    –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
    - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –æ–∂–∏–¥–∞–µ–º–∞—è –≤—ã–≥–æ–¥–∞ –æ—Ç —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –≥–∞–∑
    - –ü—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ (–æ–±—ã—á–Ω–æ 5%)
    - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π —á–µ—Ç–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –≤ USD
    - –£—á–∏—Ç—ã–≤–∞–π –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –≥–∞–∑ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
    - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è), –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º, –ø—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    
    –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
    - –ù–∞—á–∏–Ω–∞–π —Å –∫—Ä–∞—Ç–∫–æ–≥–æ —Ä–µ–∑—é–º–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è
    - –ü–æ–∫–∞–∂–∏ —Ç–µ–∫—É—â–µ–µ –∏ —Ü–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    - –£–∫–∞–∂–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
    - –ï—Å–ª–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω—É–∂–Ω–∞, –ø–æ–∫–∞–∂–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏ —Å —Å—É–º–º–∞–º–∏
    - –£–∫–∞–∂–∏ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –∏ –æ–∂–∏–¥–∞–µ–º—É—é –≤—ã–≥–æ–¥—É
    - –ó–∞–≤–µ—Ä—à–∏ —á–µ—Ç–∫–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π
    
    –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—â–∞–µ—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
    """

    available_tools: ToolManager = ToolManager([
        GetTokenPricesTool(),
        CalculateRebalancingTool(),
        EstimateGasFeesTool(),
        SuggestRebalancingTradesTool(),
        *get_crypto_tools()
    ])
    
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.max_steps = 10
        self.mode: str = "consultation"  # "consultation" –∏–ª–∏ "autonomous"
        self.target_allocation: Optional[Dict[str, float]] = None
        self.threshold_percent: float = 5.0
        self.min_profit_threshold_usd: float = 50.0

    def set_mode(self, mode: str):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 'consultation' –∏–ª–∏ 'autonomous'"""
        if mode not in ["consultation", "autonomous"]:
            raise ValueError("–†–µ–∂–∏–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'consultation' –∏–ª–∏ 'autonomous'")
        self.mode = mode

    def set_target_allocation(self, allocation: Dict[str, float]):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è"""
        self.target_allocation = allocation

    def set_threshold(self, threshold: float):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Ä–æ–≥ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö"""
        self.threshold_percent = threshold

    def set_min_profit(self, min_profit: float):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø—Ä–∏–±—ã–ª—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏"""
        self.min_profit_threshold_usd = min_profit

    async def analyze_portfolio(self, wallets: list, tokens: list, chain: str = "ethereum") -> Dict[str, Any]:
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è"""
        prompt = f"""
        –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è:
        - –ö–æ—à–µ–ª—å–∫–∏: {', '.join(wallets)}
        - –¢–æ–∫–µ–Ω—ã: {', '.join(tokens)}
        - –°–µ—Ç—å: {chain}
        
        –ü–æ–ª—É—á–∏ –±–∞–ª–∞–Ω—Å—ã –∏ —Ü–µ–Ω—ã, –∑–∞—Ç–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
        """
        response = await self.run(prompt)
        return {"analysis": response}

    async def check_rebalancing(self, wallets: list, tokens: list, 
                                target_allocation: Dict[str, float],
                                chain: str = "ethereum") -> Dict[str, Any]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è"""
        if not target_allocation:
            target_allocation = self.target_allocation or {}
        
        if not target_allocation:
            return {"error": "–¶–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"}
        
        prompt = f"""
        –ü—Ä–æ–≤–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è:
        - –ö–æ—à–µ–ª—å–∫–∏: {', '.join(wallets)}
        - –¢–æ–∫–µ–Ω—ã: {', '.join(tokens)}
        - –°–µ—Ç—å: {chain}
        - –¶–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {json.dumps(target_allocation, ensure_ascii=False)}
        - –ü–æ—Ä–æ–≥ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è: {self.threshold_percent}%
        - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: ${self.min_profit_threshold_usd}
        
        –í—ã–ø–æ–ª–Ω–∏ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
        1. –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã –ø–æ—Ä—Ç—Ñ–µ–ª—è
        2. –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤
        3. –†–∞—Å—Å—á–∏—Ç–∞–π –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        4. –û—Ü–µ–Ω–∏ –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –≥–∞–∑
        5. –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–¥–µ–ª–∫–∏, –µ—Å–ª–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–∞
        
        –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: {self.mode}
        """
        
        response = await self.run(prompt)
        return {"recommendation": response, "mode": self.mode}

    async def rebalance_portfolio(self, wallets: list, tokens: list,
                                  target_allocation: Dict[str, float],
                                  chain: str = "ethereum",
                                  auto_execute: bool = False) -> Dict[str, Any]:
        """–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –ø–æ—Ä—Ç—Ñ–µ–ª—è"""
        if self.mode == "consultation" and auto_execute:
            return {"error": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"}
        
        result = await self.check_rebalancing(wallets, tokens, target_allocation, chain)
        
        if auto_execute and self.mode == "autonomous":
            # –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            result["execution_status"] = "simulated"
            result["note"] = "–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è. –í production –∑–¥–µ—Å—å –±—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–¥–µ–ª–∫–∏."
        
        return result


async def main():
    """–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞"""
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
    agent = PortfolioRebalancerAgent(
        llm=ChatBot(
            llm_provider="openrouter",  # –∏–ª–∏ "openai", "anthropic", "gemini", "deepseek"
            model_name="x-ai/grok-4.1-fast:free" 
        )
    )
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≥–µ–Ω—Ç–∞
    agent.set_mode("consultation")  # –†–µ–∂–∏–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
    agent.set_target_allocation({
        "BTC": 40.0,
        "ETH": 35.0,
        "USDC": 25.0
    })
    agent.set_threshold(5.0)  # –ü–æ—Ä–æ–≥ 5%
    agent.set_min_profit(50.0)  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å $50
    
    print("ü§ñ –ê–≥–µ–Ω—Ç —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n")
    
    # –ü—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
    example_wallets = ["0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"]  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
    example_tokens = ["BTC", "ETH", "USDC"]
    
    print("üìä –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è...")
    result = await agent.check_rebalancing(
        wallets=example_wallets,
        tokens=example_tokens,
        target_allocation={
            "BTC": 40.0,
            "ETH": 35.0,
            "USDC": 25.0
        },
        chain="ethereum"
    )
    
    print(f"\nüìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:\n{result.get('recommendation', '–û—à–∏–±–∫–∞')}\n")


if __name__ == "__main__":
    asyncio.run(main())

